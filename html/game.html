<html>
    <head>
        <style>
            /* html, body {
                height: 100%;
                margin: 0;
            } */
            #c   {
            width: 100%;
            height: 100%;
            display: block;
            /* background: url(resources/images/bigbackgroundimage2.png) no-repeat center center ; */
            background-color: #000000;
            background-size: cover;
            }
            #playspace {
                display:flex;
                flex-wrap: nowrap;
                flex-direction: row;
                justify-content: flex-start;
                align-items: flex-start;
            }
            #buttons {
                display:flex;
                flex-wrap: nowrap;
                flex-direction: column;
                justify-content: space-between;
                align-items: flex-start;
            }
            .row {
                align-items: center;
                display: flex;
              }
              
              /* "column style" is one-third of the width with padding */
            .column {
                flex: 33.33%;
                padding: 5px;
            }
              
              body {
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center;
                text-align: center;
                height: 100vh; /* Set body height to 100% of viewport height */
                margin: 0; /* Remove default body margin */
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background-color: rgb(72, 40, 130);
              }

            @font-face {
                font-family: 'StartFont';
                src: url('assets/fonts/title.ttf') format('truetype');
            }

            #addFuel{
                font-family: 'StartFont', sans-serif;
                background-color: grey;
                font-size:30px;
                margin-top: 50px;
                margin-bottom: 20px;
                margin-left:30px;
            }
            
            #addFuel:hover {
                color: yellow; /* Change text color on hover */
                outline: none; /* Remove outline/border around text */
              }

            #launchButton{
                font-family: 'StartFont', sans-serif;
                background-color: lightgreen;
                font-size:40px;
                margin-left: 30px;
                margin-top:80px;
            }

            #launchButton:hover {
                color: yellow; /* Change text color on hover */
                outline: none; /* Remove outline/border around text */
              }
            
            #angle, #weight {
                margin-bottom: 20px;
                margin-left:30px;
                font-family: 'StartFont', sans-serif;
                color:yellow;
            }

            .hidden {
                display: none;
            }

        </style>
    </head>
    <body>
        <div id="playspace">
            <canvas id="c" width="600", height="600"></canvas>
            <div id="buttons">
                <div>
                    <button id="addFuel">Add Fuel</button>
                </div>
                <div id="angle">
                    <p>Launch Angle</p>
                    <input type="range" id="launchAngleRange" min="0" max="90">
                    <input type="text" id="launchAngleText">
                </div>
                <div id="weight">
                    <p>Payload Weight</p>
                    <input type="range" id="payloadWeightRange" min="0" max="20000">
                    <input type="text" id="payloadWeightText">
                </div>
                <div>
                    <button id="launchButton">Launch!</button>
                </div>
            </div>
        </div>
        <script>
            document.getElementById("launchButton").addEventListener("click", function() {
                // Hide the buttons and sliders
                document.getElementById("addFuel").classList.add("hidden");
                document.getElementById("angle").classList.add("hidden");
                document.getElementById("weight").classList.add("hidden");
                document.getElementById("stats").classList.remove("hidden");
            });
        </script>
    </body>
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.152.2/examples/jsm/"
          }
        }
    </script>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="module">
        import * as THREE from 'three';

        // function createBooster(){
        //     const material = new THREE.MeshBasicMaterial( 
        //     { color: 0x888B8D,
        //     //   roughness: 0.5,
        //     //   metalness: 0.5,
        //     } );
        //     const cube = new THREE.Mesh(geometry, material);
        //     scene.add( cube );
        // }
        const rocket = new THREE.Object3D()
        // rocket.position.set(0, 0, -10)
        let rocketFuels = 1;

        const rocketMaterial = new THREE.MeshBasicMaterial( 
            { color: 0x888B8D,
            //   roughness: 0.5,
            //   metalness: 0.5,
            } );

        function addMediumFuel(){
            const geometry = new THREE.CylinderGeometry( 1, 1, 1 );
            // const material = new THREE.MeshBasicMaterial( 
            // { color: 0x888B8D,
            // //   roughness: 0.5,
            // //   metalness: 0.5,
            // } );
            const cube = new THREE.Mesh(geometry, rocketMaterial);
            rocket.add(cube);
            cube.position.y += rocketFuels
            payload.position.y++
            rocketFuels++
        }

        const scene = new THREE.Scene();
        // const camera = new THREE.PerspectiveCamera( 75, canvas.innerWidth / canvas.innerHeight, 0.1, 1000 );

        const canvas = document.getElementById("c")
        const renderer = new THREE.WebGLRenderer({
            canvas,
            alpha: true,
            antialias:true
        });
        // renderer.setSize( window.innerWidth, window.innerHeight );
        // document.body.appendChild( renderer.domElement );

        const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 2000)
        renderer.setSize(canvas.width, canvas.height)
        // document.body.appendChild( renderer.domElement );


        const payloadGeometry = new THREE.ConeGeometry( 0.8, 0.5, 16 );
        const payloadMaterial = new THREE.MeshBasicMaterial( 
            { color: 0xFFFFFF,
            //   roughness: 0.5,
            //   metalness: 0.5,
            } );
        const payload = new THREE.Mesh( payloadGeometry, payloadMaterial );
        rocket.add( payload );
        payload.position.y += 1.25

        const payloadBottomGeometry = new THREE.CylinderGeometry( 0.8, 1, 0.5, 16 );
        const payloadBottomMaterial = new THREE.MeshBasicMaterial( 
            { color: 0xFFFFFF,
            //   roughness: 0.5,
            //   metalness: 0.5,
            } );
        const payloadBottom = new THREE.Mesh( payloadBottomGeometry, payloadBottomMaterial );
        rocket.add( payloadBottom );
        payloadBottom.position.y += 0.75

        const booster = new THREE.Object3D()

        const boosterBaseGeo = new THREE.CylinderGeometry(1, 1, 1)
        const boosterBase = new THREE.Mesh(boosterBaseGeo, rocketMaterial)
        
        const boosterBoosterGeo = new THREE.ConeGeometry(0.5, 0.5, 6)
        const boosterBoosterMat = new THREE.MeshBasicMaterial(
            {
                color: 0x36454F
            }
        )
        const boosterBooster = new THREE.Mesh(boosterBoosterGeo, boosterBoosterMat)
        booster.add(boosterBase)
        booster.add(boosterBooster)
        // boosterBase.position.y -= 1
        boosterBooster.position.y -= 0.5
        rocket.add(booster)

        const earthGeometry = new THREE.SphereGeometry(1000, 64, 64)
        const loader = new THREE.TextureLoader()
        const earthMaterial = new THREE.MeshBasicMaterial({
            color: 0x228B22,
            // map: loader.load("resources/images/bigbackgroundimage2.png")
        })
        const earth = new THREE.Mesh(earthGeometry, earthMaterial)

        scene.add(earth)
        earth.position.set(0, -1001.5, 0)
        earth.rotation.z += 0.5

        const backdropGeometry = new THREE.SphereGeometry(1000, 32, 32)
        const backdropMaterial = new THREE.MeshBasicMaterial({
            map: loader.load("resources/images/bgtest2.png"),
            side: THREE.BackSide
        })
        const backdrop = new THREE.Mesh(backdropGeometry, backdropMaterial)
        scene.add(backdrop)

        const launchPadGeometry = new THREE.BoxGeometry(4, 1, 4)
        const launchPadMat = new THREE.MeshBasicMaterial(
            {
                color: 0xD2D1CD
            }
        )
        const launchPad = new THREE.Mesh(launchPadGeometry, launchPadMat)
        rocket.add(launchPad)
        launchPad.position.y -= 1.25
        // backdrop.position.set(0, 0, -700)
        // backdrop.rotation.z += Math.PI

        // const light = new THREE.DirectionalLight(0xFFFFFF, 1);
        // const light = new THREE.AmbientLight(0xFFFFFF, 1);
        // light.position.set(0, 10, -1);
        // scene.add(light);
        camera.position.z = 5;
        // document.addEventListener("keydown", () => {
        //     addMediumFuel()
        //     renderer.render( scene, camera );
        // })
        const cubePos = new THREE.Vector3()
        let posChange = 0.01

        // const cubeLoader = new THREE.TextureLoader();
        // const texture = cubeLoader.load(
        //     // 'resources/images/bigbackgroundimage2.png',
        //     // "resources/images/bgtest2.png",
        //     "resources/images/panorama_image.png",
        //     () => {
        //     const rtg = new THREE.SphereGeometry(1000, 128, 128);
        //     const rtm = new THREE.MeshBasicMaterial(
        //         {
        //             map: "resources/images/bigbackgroundimage2.png",
        //             side: THREE.BackSide
        //         }
        //     )
        //     const rt = new THREE.Mesh(rtg, rtm)
        //     scene.add(rt)
        //     // rt.fromEquirectangularTexture(renderer, texture);
        //     // scene.background = rt.texture;
        //     });
        scene.add(rocket)
        function render(){
        posChange *= 1.01
        rocket.position.y += posChange;
        rocket.position.x += posChange * 0.1;
        // camera.position.y += posChange;
        // camera.position.x += 0.01;
        if(rocket.position.y < 5){
            camera.lookAt(rocket.getWorldPosition(cubePos))
        } else {
            // if(!rocket.children.contains(camera))
            camera.lookAt(rocket.getWorldPosition(cubePos))
            rocket.add(camera)
        }
        renderer.render( scene, camera );
        requestAnimationFrame(render)
        }
        renderer.render( scene, camera );
        // document.addEventListener("mousedown", () => {requestAnimationFrame(render)})
        let fuelButton = document.getElementById("addFuel")
        fuelButton.onclick = () => {

            addMediumFuel();
            renderer.render(scene, camera)
        }
        let launchButton = document.getElementById("launchButton")
        let launchPadPos = new THREE.Vector3()
        launchButton.addEventListener("click", () => {
            launchPadPos = launchPad.getWorldPosition(launchPadPos)
            let launchPadRot = rocket.rotation.z
            scene.add(launchPad)
            launchPad.position.set(launchPadPos.x, launchPadPos.y, launchPadPos.z)
            launchPad.rotation.z = launchPadRot
            requestAnimationFrame(render)
            launchButton.remove()
            fuelButton.remove()
        })
        let launchAngleRange = document.getElementById("launchAngleRange")
        let launchAngleText = document.getElementById("launchAngleText")

        launchAngleRange.value = 0
        launchAngleText.value = 0

        let payloadWeightRange = document.getElementById("payloadWeightRange")
        let payloadWeightText = document.getElementById("payloadWeightText")

        payloadWeightText.value = 16667

        launchAngleRange.addEventListener("input", () => {
            let value = launchAngleRange.value
            launchAngleText.value = value
            rocket.rotation.z = -value * Math.PI / 180
            renderer.render(scene, camera)
        })
        launchAngleText.addEventListener("input", () => {
            let value = launchAngleText.value
            launchAngleRange.value = value
            rocket.rotation.z = -value * Math.PI / 180
            renderer.render(scene, camera)
        })

        payloadWeightRange.addEventListener("input", () => {
            let value = payloadWeightRange.value
            payloadWeightText.value = value
            payload.geometry.dispose();
            payload.geometry = new THREE.ConeGeometry(value/payloadWeightRange.max, 0.5, 16);
            payloadBottom.geometry.dispose();
            payloadBottom.geometry = new THREE.CylinderGeometry(value/payloadWeightRange.max, 1, 0.5, 16);
            renderer.render(scene, camera)
        })
        payloadWeightText.addEventListener("input", () => {
            let value = payloadWeightText.value
            payloadWeightRange.value = value
            payload.geometry.dispose();
            payload.geometry = new THREE.ConeGeometry(value/payloadWeightRange.max, 0.5, 16);
            payloadBottom.geometry.dispose();
            payloadBottom.geometry = new THREE.CylinderGeometry(value/payloadWeightRange.max, 1, 0.5, 16);
            renderer.render(scene, camera)
        })
        
    </script>
    <script>

    </script>
</html>